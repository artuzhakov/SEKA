# SEKA — Механика REVEAL (REVEAL.md)

REVEAL — боевое действие, при котором:

- инициатор делает ставку `currentStake * 2`;
- выбирается цель (предыдущий активный игрок по кругу);
- оба раскрывают карты друг другу;
- проигравший выбывает из раздачи (FOLDED);
- REVEAL считается полноценным ходом инициатора.

---

## 1. Условия использования REVEAL

REVEAL доступен, если:

- текущий раунд — 2 или 3;
- игрок в статусе `IN_GAME`;
- игрок ещё не совершил действие в текущем раунде;
- у игрока достаточно баланса для `currentStake * 2`;
- существует хотя бы один активный игрок до него по кругу (для цели).

---

## 2. Поиск цели для REVEAL

Цель — предыдущий активный игрок по кругу.

Алгоритм:

```text
target = предыдущий игрок по очереди
пока target не IN_GAME:
    target = предыдущий игрок по кругу
    если вернулись к инициатору:
        target = null
        break
если target == null:
    REVEAL невозможен
```

Если цель найдена — REVEAL может быть выполнен.

---

## 3. Ставка при REVEAL

Финансовая логика:

```text
stake = currentStake * 2
balance -= stake
player.bet += stake
pot += stake
```

`currentStake` **НЕ изменяется**.

REVEAL не влияет на текущий уровень ставок, он только добавляет фишки инициатора в банк.

---

## 4. Открытие карт

После выполнения ставки:

- инициатор и цель REVEAL видят карты друг друга;
- остальные игроки их карты не видят.

---

## 5. Разрешение результата (RESOLVE)

- считается комбинация обоих игроков (см. `CARD_SYSTEM.md`);
- определяется победитель по очкам;
- при равенстве можно определить дополнительные правила (по согласованной логике, например — ничья не допускается, но это можно доопределить).

Проигравший:

- получает статус `FOLDED`;
- выбывает из текущей раздачи;
- остаётся за столом как `TABLE_WAITING` после завершения игры.

Победитель:

- сохраняет статус `IN_GAME`.

REVEAL — это **полноценное действие** инициатора в раунде, ход не повторяется.

---

## 6. Тайминг REVEAL

REVEAL использует:

- основной таймер хода (30 сек) для выбора действия;
- дополнительный `REVEAL_RESOLVE_TIMER = 15` секунд — пауза для:
  - отображения карт,
  - анимаций,
  - визуального понимания результата.

После истечения `REVEAL_RESOLVE_TIMER`:

- проигравший фиксируется как `FOLDED`;
- ход переходит к следующему активному игроку по очереди.
