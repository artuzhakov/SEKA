# SEKA — Система ставок (BETTING_RULES.md)

Этот документ описывает:

- базовую ставку стола (`baseBet`);
- анте (вход в раздачу);
- текущую ставку (`currentStake`);
- индивидуальные ставки игроков (`player.bet`);
- поведение при `CALL`, `RAISE`, `CHECK`, `FOLD`, `DARK`, `REVEAL`;
- взаимодействие с банком (`pot`) и балансом игрока.

---

## 1. Основные понятия

### 1.1 Базовая ставка стола (`baseBet`)

Для каждого стола задаётся:

- `baseBet` — начальная ставка,
- минимальный баланс = `baseBet * 10`,
- ограничения максимальной ставки и входа на стол.

### 1.2 Анте (вход в раздачу)

Перед началом раздачи:

- у каждого готового игрока списывается `baseBet`;
- эта сумма добавляется в банк (`pot`);
- фиксируется начальная ставка игрока:

```text
player.bet = baseBet
currentStake = baseBet
pot = baseBet * N_игроков
```

Анте — это первая ставка игрока в игре.

---

### 1.3 Текущая ставка (`currentStake`)

`currentStake` — это **уровень ставки**, который:

- должен быть покрыт (`CALL`) всеми игроками, желающими продолжать участие;
- может быть увеличен только действием `RAISE`;
- используется как основа для темных ставок и REVEAL.

Изначально:

```text
currentStake = baseBet
```

Меняется только при `RAISE`.

---

### 1.4 Индивидуальная ставка игрока (`player.bet`)

`player.bet` — это сумма всех ставок игрока за текущую игру:

```text
player.bet = ante + все последующие ставки/доплаты
```

Важно:

- не обнуляется между раундами;
- используется при вычислении сумм доплаты (`CALL`) и повышений (`RAISE`).

---

### 1.5 Банк (`pot`)

`pot` — суммарные деньги всех игроков в текущей игре.  
Увеличивается при:

- анте,
- `CALL`,
- `RAISE`,
- `DARK`-ставках,
- `REVEAL`,
- входах в Свару (`SVARA.md`).

---

## 2. Действия и ставки

### 2.1 CHECK

Доступен только:

- в 1-м раунде;
- только игроку сразу после дилера.

CHECK:

- не изменяет `player.bet`;
- не изменяет `pot`;
- не изменяет `currentStake`.

Игрок просто «пропускает» ход без дополнительной ставки.

---

### 2.2 CALL

Игрок покрывает текущую ставку.

Формула:

```text
required = currentStake - player.bet
если required > 0:
    снимаем required с баланса игрока
    player.bet += required
    pot += required
иначе:
    списаний нет, действие считается валидным
```

---

### 2.3 RAISE

Игрок повышает ставку.

Условия:

```text
newStake > currentStake
currentStake = newStake
```

Игрок должен мгновенно покрыть `newStake`:

```text
delta = newStake - player.bet
снимаем delta с баланса
player.bet = newStake
pot += delta
```

Только `RAISE` изменяет `currentStake`.

---

### 2.4 FOLD

Игрок сбрасывает карты и выходит из текущей раздачи.

Эффекты:

- статус игрока → `FOLDED`;
- его текущая ставка (`player.bet`) остаётся в `pot`;
- он не участвует дальше в торгах;
- его режим (DARK/OPEN) не имеет значения.

По правилам проекта, AUTO-FOLD (таймаут) дополнительно может означать выход со стола в глобальное лобби.

---

### 2.5 DARK — ставка в тёмную

Режим DARK описан в `DARK_OPEN.md`.  
Здесь фиксируется финансовая модель.

Когда игрок в режиме DARK делает ставку:

```text
costForPlayer = currentStake / 2
fullStake = currentStake
```

Денежные потоки:

```text
balance -= costForPlayer
pot += fullStake
player.bet += fullStake
```

Игрок «платит» половину, но считается поставившим полную ставку.

Если после этого `currentStake` увеличивается (чужой `RAISE`), при `CALL` для DARK действует та же логика:

```text
diff = newStake - player.bet
playerPays = diff / 2
balance -= playerPays
pot += diff
player.bet += diff
```

---

### 2.6 OPEN

OPEN — это выбор режима, **не ставка**.

- не списывает деньги;
- не изменяет `player.bet`;
- не изменяет `pot` и `currentStake`;
- лишь открывает игроку его карты и фиксирует, что DARK больше недоступен.

---

### 2.7 REVEAL

REVEAL — боевое действие, описано подробно в `REVEAL.md`.  
С точки зрения ставок:

```text
revealStake = currentStake * 2
balance -= revealStake
player.bet += revealStake
pot += revealStake
```

`currentStake` при этом **НЕ изменяется**.

REVEAL:

- считается полноценным действием в раунде;
- приводит к немедленному сравнению двух игроков;
- проигравший становится `FOLDED` (вылетает из раздачи, но остаётся за столом).

---

## 3. Сброс ставок между раундами

`player.bet` и `currentStake` **не обнуляются** между раундами:

- банк и ставки продолжают накапливаться;
- игроки лишь получают новый ход.

Логика «сброса ставок» реализуется не через обнуление `player.bet`, а через:

- использование таймеров,
- FOLD / AUTO-FOLD,
- корректное обновление `currentStake` только через `RAISE`.

---

## 4. Итоговые правила

- Анте задаёт исходную точку: `player.bet = baseBet`.
- Вся система ставок завязана на `currentStake`.
- Менять `currentStake` может только `RAISE`.
- DARK даёт возможность «платить меньше, ставить больше».
- REVEAL — это всегда `currentStake * 2` поверх текущих ставок игрока.
- Никаких автоматических вылетов по «недостатку ставки» в конце раунда нет — за всё отвечает поведение игрока и таймеры.
